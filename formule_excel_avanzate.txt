🧮 FORMULE EXCEL AVANZATE PER PIANO INDUSTRIALE BANCARIO
=======================================================

⚠️ IMPORTANTE: Usa SEMPRE il PUNTO E VIRGOLA (;) come separatore!

📊 1. CALCOLI FINANZIARI BASE
--------------------------------

NPV (Valore Attuale Netto):
=NPV(tasso_sconto;flussi_cassa)
Esempio: =NPV(0,1;B10:F10)

IRR (Tasso Interno di Rendimento):
=IRR(flussi_cassa;stima_iniziale)
Esempio: =IRR(B10:F10;0,1)

ROE (Return on Equity):
=utile_netto/patrimonio_netto
Esempio: =B25/B30

ROA (Return on Assets):
=utile_netto/attività_totali
Esempio: =B25/B35

Cost of Risk:
=accantonamenti_crediti/crediti_lordi
Esempio: =B40/B45


📈 2. CALCOLI TEMPORALI E CRESCITA
----------------------------------

Tasso di crescita composto (CAGR):
=POWER(valore_finale/valore_iniziale;1/anni)-1
Esempio: =POWER(F10/B10;1/5)-1

Media mobile:
=AVERAGE(OFFSET(cella;-periodi+1;0;periodi;1))
Esempio: =AVERAGE(OFFSET(B10;-3;0;4;1))

Crescita anno su anno:
=(valore_attuale/valore_precedente)-1
Esempio: =(C10/B10)-1


💰 3. CALCOLI BANCARI SPECIFICI
-------------------------------

Margine di Interesse Netto (NIM):
=ricavi_interesse_netti/attività_fruttifere
Esempio: =B50/B55

Ratio di Efficienza (Cost-to-Income):
=costi_operativi/ricavi_operativi
Esempio: =B60/B65

Ratio di Liquidità:
=attività_liquide/passività_correnti
Esempio: =B70/B75

Ratio di Capitale (Capital Ratio):
=patrimonio_netto/attività_ponderate_rischio
Esempio: =B80/B85


🎯 4. FORMULE CONDIZIONALI AVANZATE
-----------------------------------

IF multipli (nested IF):
=IF(condizione1;risultato1;IF(condizione2;risultato2;risultato3))
Esempio: =IF(B10>0;B10*0,1;IF(B10<0;B10*0,05;0))

SUMIFS (somma condizionale):
=SUMIFS(intervallo_somma;intervallo_criteri1;criteri1;intervallo_criteri2;criteri2)
Esempio: =SUMIFS(D:D;A:A;"Crediti";B:B;">0")

COUNTIFS (conta condizionale):
=COUNTIFS(intervallo_criteri1;criteri1;intervallo_criteri2;criteri2)
Esempio: =COUNTIFS(A:A;"RE";B:B;">1000000")

AVERAGEIFS (media condizionale):
=AVERAGEIFS(intervallo_media;intervallo_criteri1;criteri1)
Esempio: =AVERAGEIFS(C:C;A:A;"SME")


📊 5. LOOKUP E RICERCHE AVANZATE
--------------------------------

VLOOKUP:
=VLOOKUP(valore_ricerca;tabella;colonna_indice;FALSE)
Esempio: =VLOOKUP(A10;Input!A:D;4;FALSE)

INDEX + MATCH (più flessibile di VLOOKUP):
=INDEX(colonna_risultato;MATCH(valore_ricerca;colonna_ricerca;0))
Esempio: =INDEX(D:D;MATCH(A10;B:B;0))

XLOOKUP (se disponibile - Excel 365):
=XLOOKUP(valore_ricerca;array_ricerca;array_risultato)
Esempio: =XLOOKUP(A10;B:B;D:D)


⏰ 6. FUNZIONI DATA E TEMPO
---------------------------

EOMONTH (fine mese):
=EOMONTH(data_inizio;mesi)
Esempio: =EOMONTH(A10;3)

DATEDIF (differenza date):
=DATEDIF(data_inizio;data_fine;"M")
Esempio: =DATEDIF(A10;B10;"M")

NETWORKDAYS (giorni lavorativi):
=NETWORKDAYS(data_inizio;data_fine)
Esempio: =NETWORKDAYS(A10;B10)


🔢 7. FUNZIONI STATISTICHE
---------------------------

PERCENTILE:
=PERCENTILE(array;percentile)
Esempio: =PERCENTILE(B:B;0,95)

STDEV (deviazione standard):
=STDEV(array)
Esempio: =STDEV(B10:F10)

CORREL (correlazione):
=CORREL(array1;array2)
Esempio: =CORREL(B:B;C:C)


📋 8. ESEMPIO FORMULA COMPLESSA PER PIANO INDUSTRIALE
----------------------------------------------------

Calcolo Provision for Credit Losses dinamico:
=IF(crediti_lordi>0;
   MAX(crediti_lordi*cost_of_risk_base;
       crediti_lordi*cost_of_risk_stress*scenario_stress);
   0)

In Excel:
=IF(B100>0;MAX(B100*Input!D50;B100*Input!D51*Input!D52);0)


Calcolo ROE Forward-Looking:
=IF(patrimonio_netto_proiettato>0;
   utile_netto_proiettato/patrimonio_netto_proiettato;
   0)

In Excel:
=IF(F200>0;F150/F200;0)


💡 SUGGERIMENTI GENERALI:
========================

1. Usa SEMPRE il punto e virgola (;) come separatore
2. Le funzioni devono essere in inglese (SUM, IF, etc.)
3. Usa riferimenti assoluti ($A$1) per parametri fissi
4. Usa nomi definiti per rendere le formule più leggibili
5. Testa sempre le formule con dati di esempio
6. Documenta formule complesse con commenti nelle celle adiacenti

🚨 ERRORI COMUNI DA EVITARE:
===========================

❌ =IF(A1>0,B1,C1)     ← Virgola sbagliata
✅ =IF(A1>0;B1;C1)     ← Punto e virgola corretto

❌ =SUM(A1,A2,A3)      ← Virgola sbagliata  
✅ =SUM(A1;A2;A3)      ← Punto e virgola corretto

❌ =VLOOKUP(A1,B:D,3,0) ← Virgola sbagliata
✅ =VLOOKUP(A1;B:D;3;0) ← Punto e virgola corretto