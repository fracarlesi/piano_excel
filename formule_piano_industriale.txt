🏦 FORMULE SPECIFICHE PER IL TUO PIANO INDUSTRIALE BANCARIO
============================================================

Basato sull'analisi del tuo file modello.xlsx
Fogli: Input | Calcoli | Output

⚠️ SINTASSI: Usa SEMPRE il punto e virgola (;) come separatore!

📊 1. COLLEGAMENTI TRA FOGLI
----------------------------

Dal foglio Input al foglio Calcoli:
=Input!D8    ← Euribor Y1 (riga 8, colonna D)
=Input!E8    ← Euribor Y2 (riga 8, colonna E)

Riferimento dinamico per parametri:
=INDEX(Input!D:X;8;COLUMN()-2)    ← Euribor per anno corrente

Media Euribor multi-anno:
=AVERAGE(Input!D8:I8)    ← Media Euribor da Y1 a Y6


💰 2. CALCOLI EROGAZIONI (MATRICE 1)
------------------------------------

Nel foglio Calcoli, area erogazioni (riga 9+):

Erogazione trimestrale:
=Input!D55*Input!D58    ← Già presente nella riga 9

Erogazione cumulata:
=SUM($B9:B9)    ← Somma da inizio anno

Erogazione anno su anno growth:
=IF(B9>0;C9/B9-1;0)    ← Crescita rispetto al trimestre precedente

Erogazione per prodotto (se hai segmentazione):
=Input!D55*Input!D58*Input!D60    ← Volume * Percentuale * Mix prodotto


📈 3. CALCOLI P&L (FOGLIO OUTPUT)
---------------------------------

Interest Income calculation:
=Calcoli!B50*Input!D8/4    ← Stock crediti * Tasso / 4 trimestri

Interest Expense calculation:
=Calcoli!B60*Input!D9/4    ← Stock depositi * Tasso passivo / 4

Net Interest Income:
=B5-B15    ← Interest Income - Interest Expense

Cost of Risk:
=Calcoli!B45*Input!D45    ← Stock crediti * CoR rate

Operating Costs:
=Input!D70+Input!D71+Input!D72    ← Personnel + IT + Other costs

Pre-Tax Profit:
=B20-B25-B30    ← NII - CoR - OpEx


🏛️ 4. STATO PATRIMONIALE (BALANCE SHEET)
----------------------------------------

Stock Crediti fine periodo:
=B100+B9-B25    ← Stock iniziale + Erogazioni - Write-offs

Stock Depositi:
=B110*Input!D80    ← Funding ratio applicato

Patrimonio Netto:
=B120+B35    ← PN iniziale + Utile accumulato

Total Assets check:
=B101+B102+B103    ← Crediti + Cash + Altri attivi

Asset-Liability check:
=B150-B160-B170    ← Deve essere zero (Assets - Liabilities - Equity)


📊 5. KPI E RATIOS
------------------

ROE annualizzato:
=B35*4/AVERAGE(B170:E170)    ← Utile trim. * 4 / PN medio

ROA annualizzato:
=B35*4/AVERAGE(B150:E150)    ← Utile trim. * 4 / Assets medi

Cost-to-Income Ratio:
=B30/B20    ← OpEx / NII

NIM (Net Interest Margin):
=B20*4/AVERAGE(B101:E101)    ← NII annualizzato / Crediti medi

Cost of Risk annualizzato:
=B25*4/AVERAGE(B101:E101)    ← CoR trimestrale * 4 / Crediti medi


⏰ 6. FORMULE TEMPORALI
-----------------------

Quarter progression:
=B7+1    ← Già presente nel tuo modello

Year calculation:
=IF(MOD(B7;4)=1;INT(B7/4)+1;C6)    ← Anno basato su trimestre

Data fine trimestre:
=DATE(2024+INT((B7-1)/4);3*MOD(B7-1;4)+3;31)    ← Ultima data trimestre

Stagionalità (se applicabile):
=1+Input!D90*COS(2*PI()*(B7-1)/4)    ← Fattore stagionale


🎯 7. SCENARI E STRESS TEST
---------------------------

Formula scenario condizionale:
=IF(Input!D95="Base";Input!D8;
   IF(Input!D95="Adverse";Input!D8*1.5;
      Input!D8*2))    ← Euribor per scenario

Stress test erogazioni:
=Input!D55*(1-Input!D96*Input!D97)    ← Volume ridotto per stress

Recovery rate dinamico:
=MAX(Input!D46;Input!D46-Input!D98*B7/12)    ← Recovery che peggiora nel tempo


🔄 8. RICONCILIAZIONI E CONTROLLI
---------------------------------

Check somma trimestri = anno:
=ABS(SUM(B5:E5)-F5)<0.01    ← Verifica coerenza

Check bilancio:
=ABS(B150-B160-B170)<0.01    ← Assets = Liabilities + Equity

Variance analysis:
=B5/Input!D100-1    ← Scostamento da budget

Alert formule:
=IF(B180=TRUE;"✅";"❌ CHECK FAILED")    ← Indicatore visivo


🚨 9. FORMULE DI DEBUGGING
--------------------------

Trace source (per capire da dove viene un valore):
="Source: "&CELL("address";Input!D8)&" = "&Input!D8

Formula audit:
=FORMULATEXT(B9)    ← Mostra la formula in formato testo

Error handling:
=IFERROR(B9/B10;"Division by zero")    ← Gestione errori


📋 10. ESEMPI IMPLEMENTAZIONE DIRETTA
-------------------------------------

Nel tuo foglio Calcoli, puoi sostituire o aggiungere:

Riga 9 (Erogazioni Q1):
ATTUALE: =Input!D55*Input!D58
MIGLIORATA: =IFERROR(Input!D55*Input!D58*Input!D100;0)

Per Interest Income (Output foglio):
=SUMPRODUCT(Calcoli!B101:B110;Input!D8:D17)/4

Per aggregazione trimestrale:
=SUM(OFFSET(Calcoli!B9;0;0;1;4))    ← Somma 4 trimestri


💡 IMPLEMENTAZIONE STEP-BY-STEP:
===============================

1. Inizia con formule semplici (collegamenti tra fogli)
2. Aggiungi calcoli intermedi (tassi, volumi)
3. Implementa P&L trimestrale
4. Costruisci stato patrimoniale
5. Calcola KPI e ratios
6. Aggiungi controlli e riconciliazioni
7. Implementa scenari alternativi

🎯 PROSSIMI PASSI:
==================

1. Scegli 2-3 formule da questa lista che ti servono di più
2. Implementale manualmente nel tuo Excel
3. Testa con dati di esempio
4. Usa lo script Python per calcoli molto complessi
5. Documenta le formule per future modifiche

Vuoi che ti aiuti con formule specifiche per una sezione particolare?